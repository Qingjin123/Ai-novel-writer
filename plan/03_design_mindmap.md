**核心开发思路：模块化与分层**

1.  **自顶向下设计，自底向上实现 (部分情况下)：**
    *   **自顶向下设计：** 从整体功能出发，将大的系统分解为主要的模块（如富文本编辑器模块、AI功能模块、知识库模块、知识图谱模块、后端API模块等）。然后进一步将每个模块分解为更小的子模块或功能点。这有助于您理解整个系统的蓝图。
    *   **自底向上实现：** 在某些情况下，您可以先实现一些基础的、会被多个模块依赖的“积木块”（例如，一个通用的API请求函数、一个文本处理工具函数）。然后用这些积木块来构建更大的模块。

2.  **关注点分离 (Separation of Concerns - SoC)：**
    这是最重要的原则之一。确保代码的不同部分只负责自己的特定功能，不要把所有逻辑都混在一起。
    *   **前端 (UI层 - Tauri + React/Vue + Tiptap):** 负责用户界面展示、用户交互、富文本编辑体验。它不应该直接操作数据库或执行复杂的AI计算。
    *   **后端 (业务逻辑与AI层 - FastAPI):** 负责处理业务规则、调用AI模型、与数据库交互、执行网络搜索等。它不应该关心UI如何展示。
    *   **Tauri主进程 (系统交互层 - Rust):** 负责创建窗口、处理原生菜单、文件系统操作等需要与操作系统底层交互的任务。它充当Web前端和操作系统之间的桥梁。

3.  **清晰的接口定义：**
    *   模块之间、前端与后端之间，都需要有明确定义的接口。
    *   **前端 <-> 后端 API：** 使用OpenAPI (Swagger) 规范来定义您的FastAPI接口。FastAPI可以自动生成这个文档。这样前端就知道如何调用后端，需要什么参数，会返回什么数据。
    *   **模块内部：** 在您的Python后端或JavaScript/TypeScript前端，一个模块（比如一个Python类或一个JS模块）也应该有清晰的公共函数/方法作为其对外暴露的接口。

**推荐的设计模式 (针对新手，从基础开始)**

设计模式是解决特定类型问题的成熟方案。作为新手，不必强求一次性掌握所有模式，但理解一些基础的、常用的模式会对您非常有帮助。

**对于前端 (React/Vue + Tiptap):**

1.  **组件化模式 (Component-Based Architecture):**
    *   **解释：** 这是React和Vue的核心。将UI拆分成独立的、可复用的组件（如按钮组件、编辑器工具栏组件、AI建议框组件）。每个组件有自己的状态(data)和行为(methods/functions)。
    *   **好处：** 提高代码复用性、可维护性，降低UI开发的复杂度。
    *   **如何做：** 思考UI的各个部分，哪些可以独立出来。比如Tiptap编辑器本身可以是一个大组件，它的工具栏可以是子组件，每个按钮又是一个更小的子组件。

2.  **状态管理模式 (State Management):**
    *   **解释：** 应用中的数据（状态）如何被存储、读取和修改。
    *   **对于新手：**
        *   **组件内部状态：** React的`useState`，Vue的`data`选项。用于管理组件自身的数据。
        *   **父子组件通信：** Props向下传递数据，事件(emits)向上传递消息。
        *   **(进阶，初期可能不需要) 全局状态管理：** 当多个组件需要共享或修改同一份数据时，可以使用React的Context API或Vue的Provide/Inject。更复杂的如Redux (React) 或 Vuex/Pinia (Vue) 可以等项目复杂度非常高时再考虑。初期避免过度设计。
    *   **好处：** 清晰地管理数据流，避免数据混乱。

**对于后端 (FastAPI - Python):**

1.  **分层模式 (Layered Architecture) - 类似MVC/MVP的思路：**
    *   **解释：** 将后端逻辑划分为不同的层次。
        *   **API层 (Controller/View层 - FastAPI的路由函数)：** 负责接收HTTP请求，验证输入参数 (使用Pydantic模型)，调用服务层处理业务逻辑，然后构造并返回HTTP响应。这一层应该保持精简。
        *   **服务层 (Service Layer/Business Logic Layer)：** 包含核心的业务逻辑。例如，`AIService`可能包含调用LLM、处理Prompt、整合RAG结果的逻辑。`KnowledgeBaseService`负责知识库的增删改查和向量检索。这一层不直接和HTTP打交道。
        *   **数据访问层 (Repository/Data Access Layer - DAL)：** 负责与数据库（PostgreSQL, Neo4j, ChromaDB）交互。将数据库操作封装起来，服务层通过调用数据访问层的方法来存取数据，而不是直接写SQL语句或数据库API调用。
    *   **好处：** 职责清晰，易于测试（可以单独测试服务层逻辑，模拟数据访问层），方便替换某个层次的实现（比如换数据库）。
    *   **如何做：** 创建不同的Python模块或包来代表这些层次，例如`app/api/`, `app/services/`, `app/repositories/`。

2.  **依赖注入 (Dependency Injection - DI):**
    *   **解释：** FastAPI内置了强大的依赖注入系统。一个组件（比如一个API路由函数或一个服务类）所依赖的其他组件（比如一个数据库连接或另一个服务）不是由它自己创建的，而是由外部（框架）“注入”进来的。
    *   **好处：** 解耦组件，使得组件更容易测试（可以注入模拟的依赖项），代码更灵活。
    *   **如何做：** FastAPI的`Depends`就是一个很好的例子。例如，您的API路由函数可以依赖一个`KnowledgeBaseService`的实例，FastAPI会自动创建并传入它。

3.  **模型-视图-控制器 (MVC) 或类似变体 (对于API而言)：**
    *   **模型 (Model - Pydantic模型)：** 定义数据的结构和验证规则。FastAPI中，Pydantic模型用于请求体、响应体验证以及与数据库ORM的交互。
    *   **视图/控制器 (View/Controller - FastAPI的路径操作函数)：** 处理用户请求，与模型和服务层交互，返回响应。
    *   **服务 (Service - 业务逻辑)：** 这一层处理实际的业务操作。

4.  **策略模式 (Strategy Pattern) - (可选，用于AI功能)：**
    *   **解释：** 当您有多种方式（策略）来完成某个任务时（比如为不同的AI功能生成不同的Prompt），可以将每种方式封装成一个独立的策略对象。然后根据需要选择并使用相应的策略。
    *   **好处：** 避免大量的if-else语句，容易添加新的策略，符合开闭原则。
    *   **如何做：** 为每个AI功能（大纲、扩写、改写）定义一个Prompt生成策略类，它们都实现一个共同的接口（比如`generate_prompt(context)`方法）。

**通用设计原则 (SOLID原则的简化理解)：**

*   **单一职责原则 (Single Responsibility Principle - SRP)：** 一个类或一个函数应该只有一个改变的理由。也就是说，它应该只做好一件事。
    *   *例子：* 一个函数不应该既负责从数据库读取用户数据，又负责将用户数据格式化为HTML。应该拆成两个函数。
*   **开闭原则 (Open/Closed Principle - OCP)：** 软件实体（类、模块、函数等）应该对扩展开放，对修改关闭。
    *   *例子：* 当需要添加新的AI功能时，理想情况是添加新的代码（新的策略类），而不是修改已有的、稳定的代码。
*   **接口隔离原则 (Interface Segregation Principle - ISP)：** 不应该强迫客户端依赖于它们不使用的方法。接口应该小而专一。
    *   *例子：* 如果您有一个大的`AIService`接口，包含所有AI相关方法，但某个客户端只需要“扩写”功能，那么它不应该被迫知道“大纲生成”等其他方法。可以考虑拆分接口。
*   **依赖倒置原则 (Dependency Inversion Principle - DIP)：** 高层模块不应该依赖于低层模块，两者都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。
    *   *例子：* 您的服务层不应该直接依赖于一个具体的数据库连接库，而应该依赖于一个抽象的“数据访问接口”，具体的数据库操作类来实现这个接口。FastAPI的依赖注入有助于实现这一点。

**需要遵守的开发规范 (针对新手)**

1.  **版本控制 (Git)：**
    *   **必须使用！** 这是现代软件开发的基石。
    *   **提交频率：** 完成一个小功能或修复一个小bug后就进行提交。不要等到写了一大堆代码才提交。
    *   **提交信息 (Commit Messages)：** 清晰、简洁地描述本次提交做了什么修改。遵循一定的格式，如 Conventional Commits (例如 `feat: add user login functionality`, `fix: correct calculation error in summary`)。
    *   **分支策略：** 至少使用主分支 (`main` 或 `master`) 和开发分支 (`develop`)。新功能开发在特性分支 (`feature/your-feature-name`)上进行，完成后合并到`develop`。

2.  **编码风格一致性：**
    *   **Python:** 遵循 **PEP 8** 规范。使用 **Black** (代码格式化工具) 和 **Flake8** (代码检查工具) 来自动保持风格一致。
    *   **JavaScript/TypeScript:** 遵循社区广泛接受的风格指南 (如 Airbnb JavaScript Style Guide 或 StandardJS)。使用 **Prettier** (代码格式化工具) 和 **ESLint** (代码检查工具)。
    *   **为什么重要：** 代码是写给人看的，一致的风格能大大提高可读性和可维护性。

3.  **命名规范：**
    *   **清晰、有意义：** 变量名、函数名、类名应该能清晰地表达它们的用途。避免使用像 `a`, `b`, `temp`, `data` 这样模糊的名称。
    *   **遵循语言习惯：**
        *   Python: 函数和变量用 `snake_case` (如 `user_name`, `calculate_score`)，类名用 `PascalCase` (如 `UserProfile`)。
        *   JavaScript/TypeScript: 函数和变量用 `camelCase` (如 `userName`, `calculateScore`)，类名和组件名用 `PascalCase` (如 `UserProfile`, `EditorToolbar`)。

4.  **注释：**
    *   **不是越多越好：** 好的代码在很多情况下是自解释的。
    *   **解释“为什么”而不是“是什么”：** 注释应该解释代码背后的逻辑、意图或一些复杂的决策，而不是简单地复述代码在做什么。
        *   *坏例子：* `# i = i + 1  // i加1`
        *   *好例子：* `# Increment retry counter to prevent infinite loop in case of persistent API failure`
    *   **文档字符串 (Docstrings)：** 为Python的模块、类、函数和方法编写文档字符串，解释它们的用途、参数和返回值。FastAPI可以利用这些信息生成API文档。TypeScript也支持类似的JSDoc风格注释。

5.  **代码结构：**
    *   **模块化：** 将相关的代码组织到不同的文件和目录中。避免一个文件包含数千行代码。
    *   **函数/方法长度：** 函数和方法应该尽量短小，专注于完成一个单一的任务。如果一个函数太长，考虑将其拆分为多个更小的辅助函数。

6.  **错误处理：**
    *   **显式处理：** 使用 `try...except` (Python) 或 `try...catch` (JavaScript/TypeScript) 来捕获和处理可能发生的错误。
    *   **不要忽略错误：** 即使只是简单地记录错误信息，也比悄无声息地失败要好。
    *   **提供有意义的错误信息：** 帮助调试和用户理解问题。

7.  **避免魔法数字和硬编码字符串：**
    *   将常量（如配置项、固定的数值、常用的字符串标签）定义为具名的常量变量，方便修改和理解。
    *   *坏例子：* `if status == 2: ...`
    *   *好例子：* `PROCESSING_STATUS = 2; if status == PROCESSING_STATUS: ...`

8.  **代码审查 (Code Review - 如果有条件)：**
    *   即使您是独立开发者，也可以在完成一个功能后，自己“扮演”审查者的角色，从头到尾阅读一遍代码，思考是否有改进空间。如果未来有团队成员，代码审查是保证质量的重要环节。

9.  **测试 (初期可以简化)：**
    *   **单元测试：** 针对小的代码单元（函数、方法）进行测试，验证其行为是否符合预期。
    *   **对于新手：** 初期可能难以全面覆盖，但至少对核心的、复杂的逻辑编写一些简单的测试，能帮您在后续修改代码时更有信心。

**工具建议：**

*   **IDE：** Visual Studio Code (VS Code) 是一个非常好的选择，它对Python, JavaScript/TypeScript, Rust (Tauri) 都有很好的支持，并且有丰富的插件生态来帮助您遵守规范 (如ESLint, Prettier, Pylint/Flake8, Black插件)。
*   **版本控制：** Git (命令行或通过VS Code的集成功能，或者SourceTree等GUI工具)。

**给新手的建议：**

*   **不要试图一次性完美：** 先让功能跑起来，然后再逐步重构和优化。
*   **从小处着手：** 先实现最核心、最简单的功能，逐步增加复杂度。
*   **多写、多练：** 编程是一门手艺，熟能生巧。
*   **遇到问题积极搜索和提问：** Stack Overflow, 官方文档，开发者社区都是很好的资源。
*   **阅读优秀开源项目的代码：** 这是学习好习惯和设计模式的绝佳途径。
