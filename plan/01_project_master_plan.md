# AI小说写作工具 - 开发需求表

**项目目标：** 开发一款功能强大、用户友好的AI辅助小说写作工具，提供从基础编辑到智能内容生成、知识管理和自主写作的全方位支持，专为macOS用户设计。

**核心技术栈：**

*   **前端UI框架：** React 或 Vue.js (待定)
*   **富文本编辑器：** Tiptap
*   **桌面应用封装：** Tauri (Rust + Webview)
*   **后端API框架：** FastAPI (Python)
*   **AI/ML库：** Hugging Face Transformers, LangChain, LlamaIndex (或其他适用Python库)
*   **关系型数据库：** PostgreSQL
*   **向量数据库：** ChromaDB (或FAISS)
*   **图数据库：** Neo4j
*   **开发平台：** macOS (针对M4芯片优化)

**阶段性开发规划建议：** 采用敏捷迭代的开发方式，从MVP（最小可行产品）开始，逐步完善和增加功能。

---

**一、 核心应用与基础编辑 (MVP阶段重点)**

| 模块/功能             | 子功能/需求                                                                                                                               | 技术实现/关键点                                                                                                                                                                                          | 用户体验/备注                                                                                                |
| :-------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------- |
| **1. 桌面应用外壳**   | 1.1 macOS原生风格窗口<br>1.2 菜单栏集成 (文件、编辑、视图、AI功能等)<br>1.3 应用设置与偏好<br>1.4 文件管理 (创建、打开、保存小说项目)                                                                                                | Tauri (Rust后端处理窗口和系统交互，WebView渲染UI)<br>macOS原生API调用 (通过Tauri插件或Rust)<br>项目文件格式定义 (例如 .aistory bundle 或特定JSON/SQLite结构)                                                              | 提供流畅、符合macOS使用习惯的体验。                                                                              |
| **2. 富文本编辑器(RTE)** | 2.1 **基础格式化：** 加粗、斜体、下划线、删除线、标题 (H1-H6)、有序/无序列表、引用块、代码块。<br>2.2 **高级格式化：** 字体选择、字号调整、文本颜色、背景色。<br>2.3 **内容插入：** 图片插入与管理、超链接。<br>2.4 **编辑体验：** 流畅的输入与渲染、撤销/重做功能、版本历史 (可选，初期可简化)。<br>2.5 **AI交互接口：** 能够获取选中文本、上下文，在指定位置插入AI生成内容，高亮AI建议等。<br>2.6 (建议) Markdown快捷输入与实时预览。 | **Tiptap** (基于ProseMirror)<br>集成到React/Vue组件中<br>设计清晰的API供AI模块调用<br>内容存储为HTML或特定JSON格式 (如Tiptap的JSON输出)                                                               | 用户写作的核心区域，必须稳定、高效、易用。<br>AI交互应无缝集成，不打断写作流。                                              |
| **3. AI接口模块**     | 3.1 LLM API集成：支持连接主流LLM API (如OpenAI, Gemini，考虑可配置)<br>3.2 API密钥管理：安全存储和管理用户API密钥 (本地或服务端)<br>3.3 统一请求封装：处理API请求、响应、错误处理、重试机制。                                                                                                | Python (FastAPI后端)<br>使用`httpx`或`requests`库调用外部LLM API<br>安全存储机制 (macOS Keychain或加密文件)                                                                                   | 对用户透明，AI功能调用的基础。                                                                                   |
| **4. 基础AI辅助功能** | 4.1 **大纲撰写：** 输入主题/概念 -> AI生成多版本大纲。<br>4.2 **灵感激发：** 输入关键词/场景 -> AI提供创意点、情节、角色等。<br>4.3 **内容扩写：** 选中简短描述 -> AI扩展为详细段落。<br>4.4 **内容改写/润色：** 选中文字 -> AI提供不同风格/措辞的改写版本，或优化表达。<br>4.5 **风格控制：** 用户选择/描述风格 -> AI生成内容贴合该风格。                                                                              | FastAPI后端实现业务逻辑<br>**Prompt Engineering是核心**：为每个功能设计专用提示词模板<br>将RTE选中文本作为上下文传入Prompt<br>结果通过API返回给前端Tiptap进行展示/插入                                          | 功能入口明确 (如右键菜单、工具栏按钮)。<br>AI生成结果应可预览、编辑、采纳或拒绝。                                              |

---

**二、 外部知识整合与增强**

| 模块/功能             | 子功能/需求                                                                                                                                    | 技术实现/关键点                                                                                                                                                             | 用户体验/备注                                                                  |
| :-------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------- |
| **5. 网络搜索与爬虫** | 5.1 实时网络搜索：用户输入关键词进行搜索。<br>5.2 （可选）定向信息抓取：从特定高质量网站抓取信息 (需用户配置或预设白名单)。<br>5.3 内容清洗与摘要：对搜索/抓取内容进行初步处理和摘要。<br>5.4 遵守Robots协议和版权。                                                                                                       | FastAPI后端<br>优先集成搜索引擎API (如Google Search API, Bing API)<br>若自建爬虫：Python `requests`, `BeautifulSoup4`, `Scrapy`<br>NLP库进行文本摘要 (如Hugging Face Transformers) | 搜索结果清晰展示，方便用户参考和引用。                                                |
| **6. 用户知识库 (RAG基础)** | 6.1 文档上传与管理：支持用户上传txt, md, pdf等格式的背景资料、设定集。<br>6.2 网络内容导入：将网络搜索结果保存到知识库。<br>6.3 **文本向量化与存储：** 将知识库文本分块 (chunking)，生成向量嵌入，存入向量数据库。<br>6.4 **语义检索：** 根据用户查询或AI上下文，从知识库中检索最相关的文本片段。                                                               | FastAPI后端<br>**向量数据库：ChromaDB** (本地，易集成)<br>文本分块与向量化：LangChain, LlamaIndex, Sentence Transformers (Python)<br>知识库管理界面 (Tauri前端)                     | 用户可以构建自己的写作素材库。<br>为AI提供精准的背景知识，提升生成内容的相关性和准确性。 |

---

**三、 深度一致性与智能化**

| 模块/功能             | 子功能/需求                                                                                                                                                              | 技术实现/关键点                                                                                                                                                                                                 | 用户体验/备注                                                                                                    |
| :-------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------- |
| **7. 小说知识图谱构建** | 7.1 实体定义：人物、地点、物品、事件、组织等核心实体类型。<br>7.2 关系定义：实体间的关系类型 (如：属于、位于、拥有、敌对、友善等)。<br>7.3 实体与关系提取：<br>    - 手动录入与编辑界面。<br>    - (进阶) 从小说文本中半自动提取实体和关系 (NER, RE)。<br>7.4 知识图谱可视化与浏览。<br>7.5 时间线管理：关键事件与时间节点的关联。                                                                 | FastAPI后端<br>**图数据库：Neo4j**<br>Schema设计：定义节点标签、属性、关系类型<br>NLP库 (spaCy, NLTK, Hugging Face) 用于辅助提取<br>前端可视化库 (如Vis.js, Cytoscape.js集成到Tauri) 或Neo4j Bloom (若适用) | 清晰管理小说设定，避免前后矛盾。<br>可视化图谱帮助作者梳理复杂关系。                                                     |
| **8. Graph RAG 支持** | 8.1 结构化查询：将AI的上下文需求转换为对知识图谱的查询 (如Cypher for Neo4j)。<br>8.2 上下文增强：将图谱查询结果 (相关实体、属性、关系) 融入LLM的提示词。<br>8.3 结合向量RAG：协同使用图谱知识和文本知识库。                                                                                                   | FastAPI后端<br>集成Neo4j Python驱动<br>LangChain或LlamaIndex对Graph RAG的支持 (或自行实现逻辑)<br>智能判断何时使用Graph RAG vs Vector RAG                                                               | AI在创作时能更好地遵循小说内部设定，尤其在涉及复杂人物关系和历史事件时。                                                   |
| **9. 综合知识检索**   | 9.1 统一检索接口：AI模块通过此接口访问网络搜索、用户知识库、小说知识图谱。<br>9.2 信息源优先级与融合：根据情境判断信息来源的可靠性和相关性。<br>9.3 （初步）一致性检查：基于检索到的知识，提示AI注意保持内容一致性。                                                                                             | FastAPI后端<br>设计统一的检索服务层，调度不同知识源的查询<br>在Prompt中明确指示AI参考提供的检索信息                                                                                                  | AI能够根据需要，智能地从不同来源获取信息，辅助写作。                                                                 |

---

**四、 自主AI Agent写作**

| 模块/功能          | 子功能/需求                                                                                                                                                             | 技术实现/关键点                                                                                                                                                                                               | 用户体验/备注                                                                                                                                  |
| :----------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| **10. 自主AI Agent** | 10.1 **目标驱动写作：** 基于用户设定 (主题、大纲、风格、角色) 和已完成内容，自主构思和撰写后续章节/情节。<br>10.2 **智能决策：** 自主判断何时需要：<br>    - 调用基础AI功能 (扩写、改写等)<br>    - 进行网络搜索<br>    - 查询用户知识库 (RAG)<br>    - 查询小说知识图谱 (Graph RAG)<br>10.3 **上下文感知与长时记忆：** 有效利用前文、知识库、知识图谱信息，保持写作连贯性和一致性。<br>10.4 **自我评估与修正 (初级)：** 对生成内容进行简单的一致性、流畅性检查，并尝试修正或提供备选项。<br>10.5 **用户干预与引导：** 允许用户在关键节点进行干预、提供指令、修正AI的写作方向。 | FastAPI后端 (Agent核心逻辑)<br>利用LLM作为推理引擎 (通过精心设计的Meta-Prompt)<br>框架参考：LangChain Agents, LlamaIndex Agents (或自研Agent架构)<br>工具集定义：将前面开发的AI功能和检索功能封装为Agent可调用的工具 | 最终目标是实现高度智能化的写作伙伴。<br>用户可以设定写作任务，Agent自主完成初稿，用户再进行修改和完善。<br>提供清晰的Agent工作状态和决策过程展示。 |

---

**五、 通用系统需求**

| 类别         | 需求                                                                                                                                   | 技术实现/关键点                                                                                               |
| :----------- | :----------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------- |
| **用户体验**   | 界面简洁直观、响应快速、操作便捷。<br>提供清晰的教程和帮助文档。<br>错误提示友好。                                                                                             | Tauri (UI/UX设计原则)<br>前端框架 (React/Vue) 组件化设计                                                              |
| **数据管理**   | 用户账户管理 (可选，初期可单机)<br>小说项目数据持久化 (章节内容、知识库索引、知识图谱数据)<br>数据备份与恢复机制 (可选，初期可依赖用户手动备份项目文件)。                                                                           | PostgreSQL (用户信息、项目元数据)<br>本地文件系统存储小说内容和索引数据 (Tauri API)<br>Neo4j, ChromaDB数据持久化配置 |
| **性能**       | 应用启动速度快。<br>富文本编辑器响应流畅，即使处理长文档。<br>AI功能调用和知识检索在可接受时间内返回结果。<br>针对M4芯片进行性能优化。                                                                                    | Tauri (Rust优势)<br>FastAPI异步特性<br>前端性能优化 (虚拟DOM、懒加载等)<br>高效的数据库查询和索引               |
| **安全性**     | 用户API密钥安全存储。<br>本地数据文件保护。<br>防止不必要的网络暴露。                                                                                                   | macOS Keychain集成 (Tauri)<br>FastAPI安全实践 (输入验证、依赖项安全等)                                              |
| **可扩展性**   | 模块化设计，方便未来新增AI功能、接入新模型或知识源。                                                                                                     | 清晰的API接口设计<br>松耦合的模块架构                                                                            |
| **可维护性**   | 代码结构清晰、注释良好、遵循编码规范。<br>关键模块有单元测试和集成测试。                                                                                                  | ESLint, Prettier (前端)<br>Black, Flake8, MyPy (Python)<br>Pytest, Vitest/Jest (测试框架)                          |
| **配置与部署** | 简单的本地安装过程。<br>AI模型和依赖库的配置管理。                                                                                                    | Tauri打包机制 (`.app`或`.dmg`)<br>Python依赖管理 (UV或PDM)                                                  |

---